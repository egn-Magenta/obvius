#!/usr/bin/perl

# prefix_css - parse a CSS and prefix each selector with something.
#
#              Used to easily generate common_local.css-files from
#              global stylesheets.
#
#              You probably need to install the CSS-module from CPAN.
#
# Copyright (C) 2005, Magenta ApS. By Adam Sjøgren. Under the GPL.

# $Id$

use strict;
use warnings;

use CSS;

my $prefix=shift @ARGV;
my $filename=shift @ARGV;

my $css=CSS->new();
$css->read_file($filename);
$css->set_adaptor("CSS::Adaptor::Pretty");
print $css->output;


# For some reason I am unable to declare my own package that inherits
# from pretty - only the first rule is output then. Oh well, be dirty:

package CSS::Adaptor::Pretty;

sub output_selectors {
	my ($self, $selectors) = @_;

	return join ', ', map { /^$prefix/ ? $_ : $prefix . ' ' . $_ } # Add the prefix, if it is not there already
            map { $_=~s/^(html|body)\s*//; $_ } # Lose html and body at the beginning of a selector - "re-root" to prefix
                map { $_->{name} } @{$selectors};
}


1;
