<% $m->call_next %>\
%
<%args>
$obvius_version=>undef
</%args>
%
<%init>
$prefix=$r->notes('prefix');
$uri=$r->notes('uri');
$obvius=$r->pnotes('obvius');
$doc=$r->pnotes('document');

$vdoc=undef; # Be sure to look up a vdoc
if ($r->pnotes('site')->param('is_admin')) {
    if ($obvius_version) {
	$vdoc=$obvius->get_version($doc, $obvius_version);
    }
    else {
	$vdoc=$r->pnotes('version');
	$vdoc=$obvius->get_public_version($doc) unless ($vdoc);
	$vdoc=$obvius->get_latest_version($doc) unless ($vdoc);
    }
}
else {
    $vdoc=$obvius->get_public_version($doc);
}
$doctype=$obvius->get_version_type($vdoc);
$r->pnotes('version' =>$vdoc);
$r->pnotes('doctype' =>$doctype);

$m->comp('/shared/path_section');
</%init>