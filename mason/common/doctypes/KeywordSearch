<& teaser, no_date=>1 &>
%
% if ($kwdocs) {
<& pager, output=>$output &>
<table width="100%" border=0>
%     my $prev_head='';
%     foreach my $kwdoc (@$kwdocs) {
%         if ($show_new_titles and ($prev_head ne $kwdoc->{new_title}) and $kwdoc->{new_title}) {
%              $prev_head=$kwdoc->{new_title};
<tr><td height=10></td></tr>
<tr>
<td valign="bottom" colspan="3" class="bigletter">
<a name="<% $kwdoc->{new_title} %>"><% $kwdoc->{new_title} %></a>
</td>
</tr>
%         }
<tr>
<td valign="top">*</td>
<td colspan=2>
<a href="<% $kwdoc->{url} %>" title="<% $kwdoc->{short_title} %>"<% $target %>><% $kwdoc->{title} %></a>
</td>
</tr>
%         if ($kwdoc->{teaser}) {
<tr>
<td></td>
<td width=5></td>
<td class="linksteaser"><& /shared/htmlize, text=>$kwdoc->{teaser} &>
</td>
</tr>
%         }
%     }
</table>
% } else {
Søgning har ingen dokumenter fundet.
% }
% #####################
%
<%args>
$output
</%args>
%
<%init>
$r->notes('hide_subdocs'=>1);

$obvius->get_version_fields($vdoc, [qw(title teaser show_teaser)]);
my $title = $vdoc->Title;
my $show_teaser=(defined $vdoc->field('show_teaser') ? $vdoc->Show_teaser : 1);
my $show_new_titles=$obvius->get_version_field($vdoc, qw(show_new_titles));

my $target = '';
$target = ' target="_blank"' if($obvius->get_version_field($vdoc, 'new_window'));

my $kwdocs = $output->param('kwdocs');

if ($show_teaser) {
    foreach (@$kwdocs) {
        if (my $doc=$obvius->get_doc_by_id($_->{id})) {
            if (my $vdoc=$obvius->get_public_version($doc)) {
                $_->{teaser}=$obvius->get_version_field($vdoc, 'teaser');
            }
        }
    }
}

# Find extra_title's and "expand" them:
my @extra;
foreach (@$kwdocs) {
    my $extra_title=$_->{extra_title};
    foreach my $new_title (@{$extra_title}) {
	# Copy $_ and put in in @extra:
	my %new=(%$_);
	$new{short_title}=$new_title;
	$new{title}=$new_title;
	push @extra, \%new;
    }
}
if (@extra) {
    # Re-sort, fix new_title and done:
    $kwdocs=[sort { lc($a->{title}) cmp lc($b->{title}) } @$kwdocs, @extra];
    my $prev='';
    map {
	my $first_letter = uc(substr($_->{title}, 0, 1));
	$_->{new_title} = ($prev ne $first_letter) ? $first_letter : '';
    } @$kwdocs;
}
</%init>