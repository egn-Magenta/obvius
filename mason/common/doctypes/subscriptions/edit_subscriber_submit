%# $Id$
%#
%if($errors) {

	<p>Du havde følgende fejl i dine indtastninger:<br />
%	map {
        <% $_->{error} %></p>
%	} @$errors;
%} else {

	<p>Dine oplysninger er gemt.

%	if($password_changed) {
		<br />Du har ændret dit password. Dit nye password vil blive sendt til <% $mailto %>.
<%perl>
		$r->pnotes('OBVIUS_OUTPUT')->param(OBVIUS_SIDE_EFFECTS => 1);
		my $smtp = Net::SMTP->new('localhost', Timeout=>30, Debug => 1);
		$mail_error = "Failed to specify a sender [$from]\n"        unless ($smtp->mail($from));
		$mail_error = "Failed to specify a recipient [$mailto]\n"   unless ($mail_error or $smtp->to($mailto));
		$mail_error = "Failed to send a message\n"                  unless ($mail_error or $smtp->data([$mailmsg]));
		$mail_error = "Failed to quit\n"                            unless ($mail_error or $smtp->quit);
</%perl>
%		if($mail_error) {
			Der opstod en fejl ved afsending af dit password:<br>
			<% $mail_error %>
%		}
%	}
    </p>
%}
<p>Klik for at <a href="?mode=choose" title="Klik her for vende tilbage til abonnementstyringen">vende tilbage til abonnementstyringen</a>.</p>

<%args>
$output
</%args>
<%init>
my $password_changed = $output->param('password_changed');
my $errors = $output->param('errors');
my $mailto = $output->param('email');
my $from = $output->param('sender');
my $passwdmsg = $output->param('mailmsg');
my $mail_error;
my $mailmsg;
if($password_changed and ! $errors) {
    $mailmsg = $m->scomp($passwdmsg, output=>$output);
}
</%init>