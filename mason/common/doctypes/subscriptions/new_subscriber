%# $Id$
%#
% if ($teaser) {
<& /shared/htmlize, text=>$teaser &>
% }
<p>Er du allerede abonnent, <a href="?mode=login" title="Log ind her"><b>log ind her</b></a></p>
<br />
Her kan du tilmelde dig udvalgte elektroniske nyheder:

<form method="get" action="./">
<input type="hidden" name="op" value="subscribe" />
<input type="hidden" name="mode" value="new_subscriber_submit" />
%if($add_one) {
<input type="hidden" name="add_one" value="<% $add_one %>" />
%}
%if($add_one_url) {
<input type="hidden" name="add_one_url" value="<% $add_one_url %>" />
%}

% if ($content) {
<& /shared/htmlize, text=>$content &>
% }
% else {
<p>Klik med musen i boksen foran de områder, du ønsker at tilmelde dig.</p>
% }

<h2>Områder</h2>

% my $i;
% foreach (@subscribe_list) {
<input id="subcheck<% $i %>" type="checkbox" name="subscription" value="<% $_->{id} %>" <% $pre_chosen{$_->{id}} ? 'checked' : '' %> />
<label for="subcheck<% $i %>">&nbsp;
<% $_->{title} %></label><br />
%     $i++;
% }

% if ($categories_list) {
<h2>Emner</h2>
%     my $i;
%     foreach (@$categories_list) {
<input id="catcheck<% $i %>" type="checkbox" name="categories" value="<% $_->{id} %>" />
<label for="catcheck<% $i %>">&nbsp;
<% $_->{name} %></label><br />
%         $i++;
%     }
% }

<p>Skriv navn og email. Til slut klikker du på <b>Opret</b>.</p>

Navn.<br />
<input type="text" size="32" name="name" />

<br /><br />
Email.<br />
<input type="text" size="32" name='new_email' <% $email ? qq{value="$email"} : '' %> />

<br />
<input type="submit" value=" Opret " />
</form>
<%args>
$output
</%args>
<%init>
my $add_one = $output->param('add_one');
my $add_one_url = $output->param('add_one_url');
my @subscribe_list = @{$output->param('subscribe_list')};
my $categories_list=$m->comp('filter_categories', categories=>$output->param('subscriber_categories'));

my $email = $output->param('_incoming_email');
my $pre_chosen = $output->param('_incoming_subscription') || [];
my %pre_chosen;

$pre_chosen = [ $pre_chosen ] unless(ref($pre_chosen) eq 'ARRAY');
foreach (@$pre_chosen) {
    $pre_chosen{$_} = 1;
}

$obvius->get_version_fields($vdoc, [qw(teaser content)]);
my $teaser=$vdoc->field('teaser');
my $content=$vdoc->field('content');
</%init>