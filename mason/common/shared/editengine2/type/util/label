%if (defined $tooltip_url) {
<div style="height: 0px; width: 0px;" id="<% $name |h %>_tooltip"></div>
%}
% if (defined $subtitle) {
<h4><& /shared/msg, text=>$subtitle &></h4>
% }
% if (defined $name) {
<label for="<% $name |h %>">
  <& /shared/msg, text=> $label &>
</label>

%if (defined $tooltip_url) {
    <img src="/grafik/spg.gif" alt="?" style="cursor: pointer; cursor: hand"
        onclick="ajax_showTooltip(
            '<% $tooltip_url %>',
            document.getElementById('<% $name |h %>_tooltip')
        )"
    />
%}
<br />\
% }
% else {
<& /shared/msg, text=>$label &><br />\
% }
%
<%args>
$label
$field
$name=>undef
</%args>
%
<%init>
use WebObvius::Tooltip qw(get_tooltip_path);

my $doctype = $obvius->get_document_type($doc);
my ($docname, $tooltip_url);

if ($field->{tooltip}) {
    $docname = $field->{tooltip};
} else {
    $docname = $doctype->param('name');
}

# Get the list of languages we want to try out
my $tooltip_langs = $r->pnotes('tooltip_languages');
unless($tooltip_langs) {
    my %valid_tooltip_languages = ( '' => 1 );
    if(my $val_tt_str = $obvius->config->param('valid_tooltip_languages')) {
        %valid_tooltip_languages = map {
            $_ => 1
        } split(/\s*,\s*/, $val_tt_str);
    }
    $tooltip_langs = [
        grep {
            $valid_tooltip_languages{$_}
        } (
            @{ $r->pnotes('language_preferences') },
            ''
        )
    ];
    $r->pnotes('tooltip_languages' => $tooltip_langs);
}

foreach my $lang (@$tooltip_langs) {
    $tooltip_url = get_tooltip_path(
        doctype => $docname,
        field => $field->{name},
        lang => $lang
    );
    if ($obvius->lookup_document($tooltip_url)) {
        $tooltip_url =~ s!/$!!;
        $tooltip_url = $prefix . $tooltip_url . '?obvius_bare=1';
    } else {
        $tooltip_url = undef;
    }
    last if(defined($tooltip_url))
}

my $subtitle=$field->{options}->{subtitle} if (exists $field->{options});
</%init>
