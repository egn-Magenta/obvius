%if (defined $tooltip_url) {
<div style="height: 0px; width: 0px;" id="<% $name |h %>_tooltip"></div>
%}
% if (defined $subtitle) {
<h4><& /shared/msg, text=>$subtitle &></h4>
% }
% if (defined $name) {
<label for="<% $name |h %>">
  <& /shared/msg, text=> $label &>
</label>

%if (defined $tooltip_url) {
<!--    <a href="#" onmouseover="ajax_showTooltip('<% $tooltip_url %>', this)" onmouseout="ajax_hideTooltip()"> -->
<!--    <a href="#" onclick="ajax_showTooltip('<% $tooltip_url %>', this)">  -->

      <img src="/grafik/spg.gif" alt="?" style="cursor: pointer; cursor: hand" onclick="ajax_showTooltip('<% $tooltip_url %>', document.getElementById('<% $name |h %>_tooltip'))" />
<!--    </a> -->
%}
<br />\
% }
% else {
<& /shared/msg, text=>$label &><br />\
% }
%
<%args>
$label
$field
$name=>undef
</%args>
%
<%init>
use WebObvius::Tooltip qw(get_tooltip_path);
my ($docname, $tooltip_url);

#    print $session->{obvius_new_doctypeid};

#find out if document is new. (that means $session->{obvius_new_doctypeid is set})
my $session = $r->pnotes('obvius_session');
my $doctype_id = $session->{obvius_new_doctypeid} if (defined $session);
my $doctype = $obvius->get_doctype_by_id($doctype_id) if (defined $doctype_id);

#If document was not new.
$doctype ||= $obvius->get_document_type($doc);

if ($field->{tooltip}) {
    $docname = $field->{tooltip};
} else {
    $docname = $doctype->param('name');
}

$tooltip_url = get_tooltip_path( doctype => $docname, field => $field->{name});
if ($obvius->lookup_document($tooltip_url)) {
    $tooltip_url =~ s!/$!!;
    $tooltip_url = $prefix . $tooltip_url . '?obvius_bare=1';
} else {
    $tooltip_url = undef;
}

my $subtitle=$field->{options}->{subtitle} if (exists $field->{options});
</%init>
