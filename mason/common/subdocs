% if (@subdocs) {

    <ul>
%     foreach (@subdocs) {
      <li><a href="./<% $_->{name} %>/"><% $_->{short_title} %></a></li>
%     }
    </ul>
% }
%
<%init>
my $subvdocs=$obvius->get_document_subdocs($doc,
                                            nothidden=>1,
                                            public=>($r->pnotes('site')->param('is_admin') ? 0 : 1),
                                            notexpired => ($r->pnotes('site')->param('is_admin') ? 0 : 1),
                                            sortvdoc=>$vdoc);
my $subdocs_with_teaser=$obvius->get_version_field($vdoc, qw(subdocs_with_teaser));

my @subdocs=map {
    my $subdoc=$obvius->get_doc_by_id($_->Docid);
    $obvius->get_version_fields($_, [qw(title short_title)]);
    $obvius->get_version_field($_, qw(teaser)) if ($subdocs_with_teaser);
    { name=>$subdoc->Name, short_title=>($_->Short_title ? $_->Short_title : $_->Title),
      teaser=>$_->field('teaser'), icons=>'', vdoc=>$_}
 } @$subvdocs;

</%init>